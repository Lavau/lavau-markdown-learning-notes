[TOC]

## 一、计算机网络和因特网

##  1.1 什么是因特网

1. 主机与端系统直接是没有区别的，它们是交换使⽤的。

2. 端系统通过通信链路和分组交换机连接到一起。

3. 分组交换机：路由器（用于网络核心中）和链路层交换机（用于接入网中）

4. 路径：一个分组从源端系统到目的端系统经过的一系列通信链路和分组交换机。

5. 端系统通过 ISP （Internet Service Provider）接入因特网。ISP 的本质是多条分组交换机和多条通信链路组成的网络。

6. 分组交换机帮助实现端系统间的数据传输，数据要被端系统上的应用程序使用。

7. 套接字接口规定了一个端系统上的应用程序通过接入因特网向另一端接入因特网的一台端系统交付数据的方式。它是一个发送程序遵守的一套规范。

**问题：请用自己的话描述下因特网（从软硬件的组成和根据基础设施提供的服务两个角度）**

8. <span style="color: red; font-weight: bold;">协议（P6）</span>：定义了在两个或多个通信实体间交换的报文的格式和顺序，以及报文发送或接受一条报文或其他事件所采取的动作。

9. 因特网中，进行交流的通信实体的所有动作都受到协议的制约。
10. 标准对于协议来说是重要，正是标准的协议让人们创造出可以相互协作的网络系统和设备。

## 1.2 网络边缘

1. 端系统：与因特网相连的计算机或其他设备。

2. 主机 = 端系统，可分为两类：客户机和服务器

3. 各个端系统位于网络边缘，通过接入网，连接到因特网。

4. 接入网：

   - 家庭接入
     - 方式：DSL（电话线接入）、电缆、FTTH（光纤）、拨号、卫星
     - 通过 LAN 将端系统和边缘路由器连起来
   - 公司
     - 方式：以太网、Wi-Fi
   - 广域无线接入
     - 方式：4G、LTE

5. **HFC 带宽 **是由⽤⼾ **共享 ** ；下⾏通道中 **没有碰撞**  —— 因为下⾏通道中，所有的包都是由头端这⼀个 **单⼀源** 发出的。

6. 以太 LAN 传输速率：10M、100M、1G、10G

   

7. |                |            |
   | -------------- | ---------- |
   | *HFC*          | *带宽共享* |
   | FTTH           | 带宽专⽤   |
   | 拨号调制解调器 | 带宽专⽤   |
   | DSL            | 带宽专⽤   |

## 1.3 网络核心

1. 网络核心是由端系统的分组交换机和通信链路组成的网状网络。

### 1.3.1 分组交换

1. 分组：源端系统向目的端系统发送报文，源端系统将长报文划分成小的数据块。
2. 分组以通信链路最大传输速率传输。
3. 储存转发：交换机开始向输出链路传输该分组的第一个比特前，要接收到整个分组。
4. 每个分组交换机有多条链路；一条链路一个输出缓存，存储发往该链路的分组。因此，排队的分组有一个排队时延。
5. 丢包：输出缓存满了，已到达的分组或在排队的分组之一会被丢弃

### 1.3.2 电路交换

1. 电路交换：端系统通信时，预留了沿路径通信所需的缓存、传输速率等资源。要知道，分组交换中，这些资源不预留。
2. <span style="color: red; font-weight: bold;">电路交换与分组交换对比</span>：
   - 电路交换：
     - 电路交换中，发送方发送数据前，要与接收方建立一条  **名副其实的连接**  ；
     - 并且，这条链路上的分组交换机要  **维护连接**  ；
     - 在这条链接上，发送方能够以  **恒定的传输速率**  向接收方传输数据。
   - 分组交换：
     - 分组通过  **一系列通信链路**  传输；
     - 不预留任何链路资源 —— 与其它分组使用同一链路时，会  **拥塞**  ；
     - **尽力交付 ** 分组，但不做保证。
3. 电路交换⽹络可以在响应时间内保证⼀定量的端到端带宽；但大部分分组交换网络无法保证端到端带宽。
4. 在电路交换中，TDM 比 FDM 有的优点：
   - FDM需要复杂的模拟硬件将信号转换为 合适的频率

## 1.4 分组交换中的时延、丢包和吞吐量

1. 分组在沿途每个节点都会经历不同类型的时延。

   - 节点总时延：节点处理时延 + 排队时延 + 传输时延 + 传播时延
   - d<sub>nodal </sub> =  d<sub>proc</sub>  +  d<sub>queue</sub>  +  d<sub>trans</sub>   +  d<sub>prop</sub> 
   - 除了排队时延是变化的外，其它三种时延都是固定的

2. 分组丢失的比例随流量强度的增加而增加。

3. 理解端到端的时延，可以做一下：**Traceroute 实验**

   

## 1.5 协议层次及其服务模型

1. 网络设计者以  **分层的方式**  组织协议以及实现协议的软硬件。

2. 一个协议层通过软件、硬件或软硬间结合的方式实现：应用层、传输层的协议几乎都是端系统上运行的软件实现的；而网络层和链路层则是软硬结合。

3. 传输层在应用程序端点之间传输报文；

   网络层是将报文段从一台主机移动到另一台主机，通过源和目的地之间的路由器路由数据报；

4. 链路层可靠的数据传输服务不同于传输层的数据可靠传输服务，传输层的数据可靠传输服务是从一个端系统到另一个端系统。

5. <span style="color: red; font-weight: bold;">封装 :</span> 发送主机端，一个应用层报文被传送给运输层。在最简单的情况下，运输层收取到该报文并附上附加信息，生成运输层报文段。运输层向网络层传递该报文段，网络层增加网络层首部信息，生成数据包。该数据报传递给链路层，链路层添加链路层首部信息，生成链路层帧。

6. <span style="color: red; font-weight: bold;">协议分层</span> ：<img src="E:\lavau-markdown-learning-notes\kaoyan\计网\计网体系结构.png" style="height: 250px;">一个应用层报文被传给运输层；

   最简单的情况下，运输层接收该报文并附上首部信息，一同构成报文段；

   运输层向网络层传递该报文段，网络层添加网络层的首部信息，生成网络层数据报；

   数据报传递给链路层，链路层添加链路层信息，形成帧。

   然后，该帧通过物理层经由链路层交换机和路由器的传输，最后，到达目的端。

   到达目的端后，端系统从链路层开始，逐层向上分解首部信息，最后得到原来的应用层报文。



## 1.6 面对攻击的网络

1. 病毒：通过某种用户交互感染用户设备的恶意软件。

   蠕虫：无须任何明显的用户交互、直接进入用户设备的恶意软件。

2. *如何生成一个僵尸网络，以及僵尸网络怎样被用于 DDoS 攻击的？*

   攻击者发现⼀些应⽤或系统的薄弱点。发现薄弱点后，攻击者需要查找可攻击的主机。⽬标⼀般是已发现漏洞的⼀系列系统。僵⼫⽹络中的任何系统都可以通过漏洞⾃动扫描它的环境，传播恶意软件。这种僵⼫⽹络的重要属性就是僵⼫⽹络的起点可以远程控制和发送命令⾄僵⼫⽹络中的所有结点的每⼀个节点。



# 二、应用层

## 2.1 应用层网络协议

1. 研发网络应用的核心：能运行在不同的端系统上；通过网络彼此通信。

2. 将应用软件限制在端系统，促进了网络应用程序的迅速研发与部署。

3. 网络应用体系结构由应用开发者设计，规定如何在各种端系统上组织该应用程序。现代网络应用程序主流的体系结构：客户 —— 服务器体系结构、对等（P2P）体系结构。

4. 客户 —— 服务器体系结构：

   一个常打开的主机成为 <u>*服务器*</u>，响应客户机的请求。

   客户机之间不能相互通信；服务器的 IP 地址固定并且所有客户机都知道。

5. P2P 的体系结构：

   对服务器有较小的（甚至没有）依赖；应用程序的主机间可以相互通信，彼此称为对等方。

6. 不同端系统上的进程，通过计算机网络交换报文，进行通信。发送进程生成报文，并通过计算机网络传输；接收进程接受该报文并可能通过回送报文做出响应。

7. 客户机与服务器：在一对会话的进程中，发起会话的进程称为客户，在会话开始等待联系的进程称为服务器。

8. 进程通过套接字接口向网络发送报文和从网络接收报文。也就是套接字是同一台主机内应用层与传输层的接口。

9. 应用开发者可控制套接字的应用层端的一切，但对于运输层端 *<u>几乎没有</u>* 控制权。

10. IP 标识主机，端口标识主机上可通信的不同进程。

11. Web 服务器端口号为 80，邮件服务器的端口号为 25.

12. 运输层对应用程序服务的要求：

    - 可靠数据传输

      接受进程接收到的报文与发送进程发送的报文内容一致

    - 吞吐量

      可用吞吐量：发送进程向接收进程交付比特的速率。

      r 比特 **/** 秒

    - 定时

    - 安全

    - 数据完整

    - 端点鉴别

13. SSL 在应用层工作。

14. 因特网提供的运输服务（运输层协议简介）：

    1. TCP

       面向连接：

       - 在应用程序交换报文前，先交换运输层的控制信息。
       - 一个 TCP 连接建立在客户与服务器的套接字接口间。
       - 全双工
       - 在会话结束前，要先断开连接。

       可靠的数据传输：

       - 保证数据从发送方无差错、按适当顺序达到接收方。

    2. UDP

    *因特网运输层协议并未实现     “ 对应用程序服务的要求 ”   中的全部内容。*

15. <span style="color: red; font-weight: bold;">应用层协议的原理 ：</span> 

    应用层协议规定了不同端系统上的应用程序如何传递报文。特别的应用层协议定义了：

    - 交换的报文类型：请求报文、响应报文
    - 各种报文类型的语法：定义哪些字段，如何描述字段
    - 字段含义
    - 确定一个进程何时以及如何发送报文，对报文响应的规则。

## 2.2 Web 和 HTTP 

1. Web 提供为用户提供按需操作 —— 用户需要什么内容，就从 Web 上获取该内容。

2. Web 的应用层协议是 HTTP；

   HTTP 是 Web 的核心，在 RFC 中进行定义。

3. HTTP 由两个程序实现：一个客户端程序和一个服务器程序。它们分别运行在不同的端系统上，通过 HTTP 报文会话。

   HTTP 协议规定 报文的结构<span style="color: red; font-weight: bold;"><sup>(1) </sup></span> 以及客户和服务器交换报文的方式<span style="color: red; font-weight: bold;"><sup>(2) </sup></span>  。

4. <span style="color: red; font-weight: bold;"><sup>(1) </sup></span>HTTP 报文：

   1. 请求报文：

      第一行叫请求行，后继的行叫首部行。

      请求行有 3 个字段：方法字段、URL、HTTP 版本

   2. 响应报文：

      状态行、首部行、实体行

5. <span style="color: red; font-weight: bold;"><sup>(2) </sup></span>Web 页面有对象组成，一个文件就是一个对象。

   HTML 文件通过对象的 URL 地址引用页面中的其他对象。

   URL = 存放对象的服务器地址 + 对象的路径名

6. <span style="color: red; font-weight: bold;"><sup>(2) </sup></span>HTTP 使用 TCP 作为运输层协议。

7. <span style="color: red; font-weight: bold;"><sup>(2) </sup></span>HTTP 协议是一个无状态协议 —— 服务器（向客户发送被请求的文件，但）不储存关于客户的状态信息。

8. <span style="color: red; font-weight: bold;"><sup>(2) </sup></span>HTTP 的默认端口号为 80，也是 Web 的默认端口号。

9. <span style="color: red; font-weight: bold;"><sup>(2)</sup></span>非持续连接：客户每次向服务器发起请求，都建立一个 TCP 连接。即：每个 TCP 连接只传输一个请求报文和一个响应报文。

   <u>粗略地讲，总的响应时间是两个 RTT（一个 RTT 创建 TCP 连接，另一个 RTT 请求和接受一个对象） 加上服务器传输 HTML 文件的时间</u>（P67）。

10. cookie 技术：

    1. cookie 技术的四个组成：
       - HTTP 请求报文有一个 cookie 首部行
       - HTTP 响应报文有一个 cookie 首部行
       - 客户端系统保留一个 cookie 文件
       - 服务器站点有一个数据库，保存 cookie 信息
    2. cookie 在无状态的 HTTP 协议之上建立一个用户会话层。

11. Web 缓存器既是服务器又是客户。

12. 部署 Web 缓存器的两个原因：

    1. 减少对客户的响应时间
    2. 降低因特网的 Web 流量

    

## 2.3 因特网中的电子邮件

1. <span style="color: red; font-weight: bold;">电子邮件系统的组成：</span>

   1. 用户代理

      - 用户代理允许用户阅读、回复、撰写报文

   2. 邮件服务器

      - 它是电子邮件系统的核心

      - 接收方在邮件服务器上有一个邮箱，邮箱管理并维护里面的报文

   3. 简单邮件传输协议（SMTP）

      - 要求运输层使用 TCP
      - 从用户代理向邮件服务器发送邮件
      - 从发送方的邮件服务器向接收方的邮件服务器发送邮件

2. SMTP 限制所有电子邮件报文的体部分只能采用 7 比特 ASCII 表示。

3. <span style="color: red; font-weight: bold;">电子邮件的发送过程：</span>

   ① 发送方的邮件代理程序提供接收方的邮件地址，并指示用户代理发送报文到他的邮件服务器，在那里该报文被放到报文列表；② 邮件服务器创建一条到接收方邮件服务器的 TCP 连接，通过该连接使用 SMTP 协议发送报文；③ 接收方的邮件服务器接收该报文，并把它放到接收方的邮箱中；④ 接收方通过他的用户代理阅读报文。

4. SMTP 一般不使用中间邮件服务器发送报文。

5. SMTP 的默认端口号为 25.

6. <span style="color: red; font-weight: bold;">SMTP 如何将一个报文从发送方电子邮件服务器发送到接收方电子邮件服务器：</span>

   ① 客户 SMTP 先与服务器 SMTP 建立一条 TCP 连接；② 客户 SMTP 和服务器 SMTP 相互介绍彼此，介绍完成后，客户 SMTP 发送邮件给服务器 SMTP；③ 如果客户 SMTP 没有别的报文发送，它指示 TCP 断开连接。

7. SMTP 与 HTTP 对比：

   |             SMTP             |             HTTP             |
   | :--------------------------: | :--------------------------: |
   |            推协议            |            拉协议            |
   | 每个报文采用 7 位 ASCII 编码 |     HTTP 数据不受此限制      |
   | 把所有报文对象放在一个报文中 | 把每个对象放在它的响应报文中 |

8. 使用 POP3、IMAP、HTTP 协议将电子邮件从邮件服务器传送到用户代理。

9. 用户代理到邮件服务器的端口为 110.

## 2.4 DNS：因特网的目录服务





































> 特别注意的内容：
>
> 1. P67 上面关于往返时间的讨论
> 2. P79 2.3.4 邮件访问协议 的 POP3、IMAP 协议的内容