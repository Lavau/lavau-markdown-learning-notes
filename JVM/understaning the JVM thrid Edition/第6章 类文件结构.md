[TOC]

# 第6章 类文件结构

## 6.1 概述（P212）

## 6.2 无关性的基石（P212）

* 平台无关性的基石：Byte Code（字节码）
* 语言无关性的基石：虚拟机与字节码的存储结构

## 6.3 Class 类文件的结构（P214）

### 6.3.1 简要说明

Class 的类文件结构很稳定，随着 Java 语言的发展很少有大的变化——基本是在原有的结构上新增内容、扩充功能，并不会对原有内容做出修改。

Class 文件是一组以 8 个字节为基础单位的二进制字节流，每个数据项目严格按照顺序排列紧凑地排列在文件中（中间不添加分隔符）。

Class 文件采用类 C 结构体的伪结构存储数据。伪结构分 2 种：

* 无符号数

  基本的数据类型，用 ```u1、u2、u3、u4``` 分别代表 1 个字节、2 个字节、3 个字节、4个字节

* 表

  描述有层次关系的复合结构的数据。由无符号数或其它表作为数据项构成的复合数据类型

  所有表的命名习惯以 ```_info``` 结尾

### 6.3.1 魔数与 Class 文件的版本（P215）

* 魔数：每个 Class 文件的头 4 个字节——0xCAFEBABE

* Class 文件的版本号：紧随其后的 4 个字节就是

高版本的 JDK 向下兼容低版本 Class 文件，但不能运行它之后的高版本的 Class 文件

### 6.3.2 常量池（P218）

版本号之后就是常量池的入口。常量池是 Class 文件中第一个出现的表类型的数据项目

常量池入口处有项 u2 类型的数据，记录常量池的容量。它从 1 开始计数。索引 0 的位置有特殊的含义：“*不引用任何一个常量池的项目*”

常量池中存放的 2 类常量：

* Literal （字面量）

  字面量接近 Java 语言层常量的概念：文本字符串、final 的常量值

* Symbolic References（符号引用）

  属于编译原理的概念，有很多类型

  **（书本中结合之前的代码例子给出了解释）**

### 6.3.3 访问标志（P224）

常量池之后的 2 个字节就是访问标志。

访问标志标识一些类或者接口层次的访问信息：该 Class 的类型、是否为 public、是否为 abstract。。。。

### 6.3.4 类索引、父类索引与接口索引集合（P225）

* 类索引：确定类的全限定类名
* 父类索引：确定该类的父类的全限定类名
* 接口索引集合：描述该类实现了哪些接口，按 `implements` 关键字后的接口顺序排列