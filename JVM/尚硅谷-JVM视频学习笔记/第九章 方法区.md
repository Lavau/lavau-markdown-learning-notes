[TOC]

# 1.  栈、堆、方法区的交互关系

## 1.1 栈、堆、方法区的交互关系

<img src="E:\mdFiles\JVM\尚硅谷-JVM视频学习笔记\picture\chapter9-1.png" height="40%" width="40%">

Java 栈上存放实例对象的引用。引用指向 Java 堆上本对象的实际内存地址。Java 堆上该内存地址中的对象头部分有指向方法区的“指针”。



# 2.  方法区的理解

## 2.1  方法区在哪

> 《规范》中明确说明：“尽管所有的方法区在逻辑上属于堆的一部分，但一些简单的实现可能不会选择进行垃圾收集或者进行压缩。”
>
> 对 Hotspot 而言，方法区还有个别名——Non-Heap，目的就是为要区分Heap。
>
> 故：**方法区看作一块独立于 Java 堆的内存区域。**

## 2.2  方法区的基本理解

1. 线程共享

2. 虚拟机在启动时被创建，物理内存空间与 Java 堆一样都是不连续的

3. 大小选择：固定、可扩展

4. 如果系统加载了太多类，可能会导致方法区溢出：

   ​	`OutOfMemoryError:PermGen space` 或 `OutOfMemoryError:Metaspace` 

5. 关闭虚拟机释放方法区的内存

## 2.3  Hotspot 中方法区的演进

1. JDK 7 之前，习惯上把方法区称为 *永久代*

   JDK 8 之后，用 *元空间*  取代 *永久代*

2. *元空间*  与 *永久代*  都是 Hotspot 对《规范》中方法区的实现。二者并不只是名字不同，内部结构也调整了。

   两者最大的区别：**元空间使用本地内存**

# 3.  设置方法区大小与OOM

```mermaid
graph LR

 [编写一个暂停一短时间的类]  
```



# 4.  方法区的内部结构



# 5.  方法区使用举例



# 6.  方法区的演进细节



# 7.  方法区的垃圾回收



# 8.  总结

